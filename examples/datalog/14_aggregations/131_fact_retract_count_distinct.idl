// Test: Fact retraction affecting count_distinct
// Description: Tests that retracting facts correctly updates count_distinct results

.kg create test_retract_cd_n14t131
.kg use test_retract_cd_n14t131

+sales[(1, "A", 5), (1, "A", 3), (1, "B", 2), (2, "A", 10), (2, "C", 4)]

+unique_products(Store, Product) <- sales(Store, Product, _)
+product_count(Store, count<Product>) <- unique_products(Store, Product)

// Initial: store 1 has 2 unique products (A, B), store 2 has 2 (A, C)
?product_count(X, Y)

// Retract all sales of product B in store 1
-sales(1, "B", 2)

// Store 1 should now have 1 unique product (A)
?product_count(X, Y)

.kg use default
.kg drop test_retract_cd_n14t131
