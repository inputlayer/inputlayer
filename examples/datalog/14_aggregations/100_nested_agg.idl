// Test: Nested aggregation pattern

.kg create test_nested_agg_n14t100
.kg use test_nested_agg_n14t100

+sales[(1, "North", "Q1", 100), (2, "North", "Q2", 150), (3, "South", "Q1", 200), (4, "South", "Q2", 250)]

// First level: sum by region
+regional_sum(Region, sum<Amount>) <- sales(_, Region, _, Amount)

// Second level: average of regional sums
+avg_regional(avg<Sum>) <- regional_sum(_, Sum)

?regional_sum(Region, Sum)
?avg_regional(Avg)

.kg use default
.kg drop test_nested_agg_n14t100
