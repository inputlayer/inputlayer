// Test: Negation + aggregation through fact mutations
// Description: Tests aggregation with negation as facts in the negated relation change

.kg create test_neg_agg_n14t172
.kg use test_neg_agg_n14t172

+score[("Alice", 90), ("Bob", 80), ("Charlie", 70)]
+banned[("Bob")]

+top(Name, max<Grade>) <- score(Name, Grade), !banned(Name)

?top(N, G)

// Unban Bob
-banned("Bob")

?top(N, G)

// Ban Alice
+banned[("Alice")]

?top(N, G)

.kg use default
.kg drop test_neg_agg_n14t172
