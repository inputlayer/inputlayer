// Test: Conditional fact deletion affecting aggregation
// Description: Tests conditional deletion (-relation(X) :- condition) with aggregation downstream

.kg create test_cond_del_agg_n14t140
.kg use test_cond_del_agg_n14t140

+score[(1, 100), (2, 200), (3, 50), (4, 300), (5, 150)]
+banned[(2), (4)]

// Aggregation on all scores
+total(sum<V>) <- score(_, V)
+top(top_k<3, Id, V:desc>) <- score(Id, V)

?total(X)
?top(X, Y)

// Delete scores of banned players
-score(X, Y) <- banned(X)

// Aggregation should reflect deletions
?total(X)
?top(X, Y)

.kg use default
.kg drop test_cond_del_agg_n14t140
