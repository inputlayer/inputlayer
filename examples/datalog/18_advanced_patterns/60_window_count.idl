// Test: Window count pattern

.kg create test_window_cnt_n18t60
.kg use test_window_cnt_n18t60

+sales[("Q1", "A", 100), ("Q1", "B", 150), ("Q1", "C", 120), ("Q2", "A", 200), ("Q2", "B", 180)]

// Count of items with lower value in same quarter (rank-like)
position(Q, Name, Val, count<N2>) <-
    sales(Q, Name, Val),
    sales(Q, N2, V2),
    V2 < Val

?position(Q, Name, Val, Pos)

.kg use default
.kg drop test_window_cnt_n18t60
